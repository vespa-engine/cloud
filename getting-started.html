---
title: "Getting Started"
---

<p>
Vespa Cloud is at the moment <a href="mailto:info@vespa.ai?subject=Sign+me+up!">invite only</a>.
</p><p>
Vespa is used for online Big Data serving, which means ranking (large) data sets using query data.
Below is an example of how to rank music albums using a user profile -
match albums with scores for a set of categories with a user's preference.
</p><p>
<strong>User profile</strong>
<pre>
{
  { cat:pop  }: 0.8,
  { cat:rock }: 0.2,
  { cat:jazz }: 0.1
}
</pre>
<strong>Albums</strong>
<pre>
{
  "fields": {
    "album": "A Head Full of Dreams",
    "artist": "Coldplay",
    "year": 2015,
    "category_scores": {
      "cells": [
        { "address": { "cat": "pop"},  "value": 1  },
        { "address": { "cat": "rock"}, "value": 0.2},
        { "address": { "cat": "jazz"}, "value": 0  }
      ]
    }
  }
}

{
  "fields": {
    "album": "Love Is Here To Stay",
    "artist": "Diana Krall",
    "year": 2018,
    "category_scores": {
      "cells": [
        { "address": { "cat": "pop" },  "value": 0.4 },
        { "address": { "cat": "rock" }, "value": 0   },
        { "address": { "cat": "jazz" }, "value": 0.8 }
      ]
    }
  }
}

{
  "fields": {
    "album": "Hardwired...To Self-Destruct",
    "artist": "Metallica",
    "year": 2016,
    "category_scores": {
      "cells": [
        { "address": { "cat": "pop" },  "value": 0 },
        { "address": { "cat": "rock" }, "value": 1 },
        { "address": { "cat": "jazz" }, "value": 0 }
      ]
    }
  }
}
</pre>
<strong>Rank profile</strong>
</p><p>
A <a href="https://docs.vespa.ai/documentation/ranking.html">rank profile</a>
calculates a <em>relevance score</em> per document.
This is defined by the application author - in this case, it is the tensor product.
The data above is represented using <a href="http://docs.vespa.ai/documentation/tensor-user-guide.html">tensors</a>.
As the tensor is one-dimensional (the <em>cat</em> dimension), this a vector,
hence this is the dot product of the user profile and album categories:
<pre>
rank-profile rank_albums inherits default {
    first-phase {
        expression: sum(query(user_profile) * attribute(category_scores))
    }
}
</pre>
Hence, the expected scores are:
<table class="table">
<tr><th>Album</th>                                   <th>pop</th>     <th>rock</th>    <th>jazz</th>      <th>total</th></tr>
<tr><td>A Head Full of Dreams</td>         <td>0.8*1.0</td><td>0.2*0.2</td><td>0.1*0.0</td><td>0.84</td></tr>
<tr><td>Love Is Here To Stay</td>            <td>0.8*0.4</td><td>0.2*0.0</td><td>0.1*0.8</td><td>0.4</td></tr>
<tr><td>Hardwired...To Self-Destruct</td><td>0.8*0.0</td><td>0.2*1.0</td><td>0.1*0.0</td><td>0.2</td></tr>
</table>
Build and test the application, and validate that the document's <em>relevance</em> (i.e. score) is the expected value,
and the results are returned in descending relevance order.
</p>

<hr />
<p>
Prerequisites for the sample apps are git and a X.509 certificate.
See <a href="security-model">Security Model</a> for keys and certificates.
A certificate is also generated below.
</p>
<ol>
    <li>
        <p>
        <strong>Create a Vespa Cloud application</strong>
        </p><p>
        This requires a Google account.
        Go to <a href="http://console.vespa.ai">console.vespa.ai/</a>,
        click "Create application", enter application name.
        </p>
    </li>
    <li>
        <p>
        <strong>Copy repo using <a href="https://github.com/vespa-engine/sample-apps/generate" data-proofer-ignore>
        github.com/vespa-engine/sample-apps/generate</a> (log in to GitHub first), or download the repo with the
            <a href="https://github.com/vespa-engine/sample-apps/tree/master/vespa-cloud/album-recommendation">album-recommendation</a>
            sample app</strong>
<pre>
$ git clone https://github.com/vespa-engine/sample-apps.git &amp;&amp; cd sample-apps/vespa-cloud/album-recommendation
</pre>
        </p>
    </li>
    <li>
        <p>
        <strong>Create a self-signed certificate</strong>
        </p>
        <p>
          This certificate and key will be used to send requests to Vespa Cloud later.
        </p>
<pre>
$ openssl req -x509 -nodes -days 14 -newkey rsa:4096 \
  -subj "/CN=cloud.vespa.example" \
  -keyout data-plane-private-key.pem -out data-plane-public-cert.pem
</pre>
        Alternatively, copy an existing key to current working directory, if you have one.
        More details in <a href="security-model#data-plane">Data Plane</a>,
        see <em>Client certificate</em>.
        </p>
    </li>
    <li>
        <p>
        <strong>Create the application package</strong>
<pre>
$ mkdir -p src/main/application/security &amp;&amp; cp data-plane-public-cert.pem src/main/application/security/clients.pem
$ cd src/main/application &amp;&amp; zip -r ../../../application.zip . &amp;&amp; cd ../../..
</pre>
        </p>
    </li>
    <li>
        <p>
        <strong>Deploy the application</strong>
        </p><p>
        In the Vespa console, click <em>Deploy</em> on the application created in the start of this guide.
        In the "Deploy to dev" section, upload <em>application.zip</em> - click <em>Deploy</em>.
        </p><p>
        Now is a good time to read <a href="http://cloud.vespa.ai/automated-deployments">automated-deployments</a>,
        as first time deployments takes a few minutes.
        Track progress in <em>Deploy application</em> and <em>Install application</em> panes.
        Seeing CERTIFICATE_NOT_READY / PARENT_HOST_NOT_READY / LOAD_BALANCER_NOT_READY is normal.
        The endpoint URL is printed in the <em>Install application</em> section when the deployment is successful -
        copy this for the next step.
        </p>
    </li>
    <li>
        <p>
        <strong>Click <em>Instances</em> at the top, then <em>endpoints</em></strong>
        </p><p>
        Try the endpoint to validate it is up
        (also see <a href="/security-model#using-a-browser">using a browser</a>):
<pre>
$ ENDPOINT=https://end.point.name
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem $ENDPOINT
</pre>
        </p>
    </li>
    <li>
        <p>
        <strong>Feed documents</strong>
<pre>
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
  -H "Content-Type:application/json" --data-binary @src/test/resources/A-Head-Full-of-Dreams.json \
  $ENDPOINT/document/v1/mynamespace/music/docid/1
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
  -H "Content-Type:application/json" --data-binary @src/test/resources/Love-Is-Here-To-Stay.json \
  $ENDPOINT/document/v1/mynamespace/music/docid/2
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
  -H "Content-Type:application/json" --data-binary @src/test/resources/Hardwired...To-Self-Destruct.json \
  $ENDPOINT/document/v1/mynamespace/music/docid/3
</pre>
        </p>
    </li>
    <li>
        <p>
        <strong>Recommend albums</strong>
        </p><p>
        Send user profile in query, find recommended albums in the result set:
<pre>
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
"$ENDPOINT/search/?ranking=rank_albums&amp;yql=select%20%2A%20from%20sources%20%2A%20where%20sddocname%20contains%20%22music%22%3B&amp;ranking.features.query(user_profile)=%7B%7Bcat%3Apop%7D%3A0.8%2C%7Bcat%3Arock%7D%3A0.2%2C%7Bcat%3Ajazz%7D%3A0.1%7D"
</pre>
        </p>
    </li>
</ol>

<hr />

<p>
Next steps:
<ol>
  <li>
      <p>
      <strong>Explore a sample app with custom java code</strong>
      </p><p>
      Try <a href="https://github.com/vespa-engine/sample-apps/tree/master/vespa-cloud/album-recommendation-java">album-recommendation-java</a>.
      </p>
  </li>
  <li>
      <p>
      <strong>Implement a system and staging test</strong>
      </p><p>
      Vespa Cloud has a secure, feature-rich, continuous deployment pipeline - read more in
      <a href="automated-deployments">automated deployments</a>.
      </p>
  </li>
  <li>
      <p>
      <strong>Deploy to a production zone</strong>
      </p><p>
      Deploy a <a href="security-model">secure</a> production application.
      </p>
  </li>
</ol>
</p>



<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
  <li>
  <strong>Slow deployments:</strong>
  First time deployments takes a few minutes,
  seeing CERTIFICATE_NOT_READY / PARENT_HOST_NOT_READY / LOAD_BALANCER_NOT_READY is normal.
  "Installation succeeded!" in the bottom pane indicates success
  </li><li>
  <strong>HTTP: 502 — Bad Gateway:</strong> This means the endpoint is not ready, or failing.
  A Vespa software upgrade will cause this — the application will then be unavailable for 15 minutes or so,
  as dev instances are not redundant. Look for stopping services in logs to check for this.
  </li><li>
  <strong>Retrying — request failed: Java heap space:</strong> If this happens when deploying from the laptop, mvn runs out of memory.
  Use export MAVEN_OPTS=-Xmx3g to increase the heap size to 3G (or larger as needed).
  </li>
</ul>
