---
# Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.
title: "Setting up monitoring with Prometheus and Grafana for Vespa Cloud"
---

<p>
This guide describes how to set up monitoring with Prometheus and Grafana for Vespa Cloud.
This guide assumes access to a Vespa Cloud instance, as well as a Prometheus and Grafana instance.
It is recommended to use Grafana Cloud, but any Grafana instance that is capable of reaching the Prometheus
instance should be sufficient for the task.
</p>

<strong>Prerequisites</strong>:
<ul>
  <li>A Vespa Cloud instance
  <li>A Grafana instance
  <li>A Prometheus instance
</ul>

<h2> Configuring Prometheus:</h2>
<p>
Prometheus is configured using <em>prometheus.yml</em>. Download it from the
<a href="https://github.com/vespa-engine/sample-apps/tree/master/album-recommendation-monitoring/prometheus"> prometheus
</a> folder.
We are interested in the prometheus-cloud.yml file, which is designed to be easy to set up with any Vespa Cloud instance.
Replace \< Endpoint \> and \< SERVICE_NAME \> with the endpoint for your application and the service name respectively.
In addition, the path to the private key and public cert that is used for the data plane to your endpoint need to be provided.
See the <a href=https://cloud.vespa.ai/security-model.html> security model </a> page for more information about accessing the data plane.
Then, simply configure your Prometheus instance to use this configuration file.
Once this has been done, your Prometheus instance should be able to start retrieving the metrics from Vespa Cloud.
If the Prometheus instance is used for multiple services, simply append the target configuration for Vespa to scrape_configs.
</p>

<h2>Configuring Grafana Dashboard:</h2>
<p>
To start configuring Grafana, download the
<a href="https://github.com/vespa-engine/sample-apps/tree/master/album-recommendation-monitoring/grafana/provisioning">
provisioning folder</a> from sample-apps.
This will serve as a baseline for further configuration.
</p><p>
In the provisioning folder there are a few different files that all help for configuring Grafana locally.
These work as good examples of default configurations, but the most important is the file named Vespa-Engine-Advanced-Metrics-External.json.
This is a default dashboard, based upon the metrics the Vespa team use to monitor performance.
</p><p>
Click the + button on the side and go to import. Upload the file to the Grafana instance.
This should automatically load in the dashboard for usage.
For now it will not display any data as we have not yet configured data sources.
</p>

<h2>Configuring Grafana Datasource:</h2>
<p>
The Prometheus datasource has to be added to the Grafana instance for the visualisation to work.
Click the cog on the left and then "Data Sources".
Click "Add data source" and choose Prometheus from the list.
Add the URL for the Prometheus instance with appropriate bindings for connecting.
The configuration for the bindings will depend on how your Prometheus instance is hosted.
Once the configuration details have been entered, click Save &amp; Test at the bottom and ensure that Grafana says "Data source is working".
</p>

<h2> Verifying Data Flow:</h2>
<p>
Navigate back to the Vespa Metrics dashboard by clicking the dashboard symbol on the left (4 blocks) and clicking manage and then click Vespa Metrics.
Data should now be appearing in the Grafana dashboard.
If no data is appearing, edit one of the data sets and ensure that it has the right data source selected.
The name of the data source the dashboard is expecting might be different from what your data source is named.
If there is still no data appearing, it either means that the Vespa instance is not being utilized or that some part of the configuration is wrong.
</p>
