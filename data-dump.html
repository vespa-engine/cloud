---
# Copyright Verizon Media. All rights reserved.
title: Data dump
---

<p>
To get started, find <em>namespace</em> and <em>document type</em> by listing a few IDs.
Hit the <a href="https://docs.vespa.ai/documentation/reference/document-v1-api-reference.html">/document/v1/</a> ENDPOINT.
Restrict to one CLUSTER, see <a href="https://docs.vespa.ai/documentation/reference/services-content.html">content clusters</a> (most apps have only one cluster):
<pre>
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
  "$ENDPOINT/document/v1/?cluster=$CLUSTER"
</pre>
For ID dump only, use a <a href="https://docs.vespa.ai/documentation/documents.html#fieldsets">fieldset</a>:
<pre>
$ curl --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
  "$ENDPOINT/document/v1/?cluster=$CLUSTER&fieldSet=%5Bid%5D"
</pre>
</p><p>
From an ID, like <em>id:open:doc::open/documentation/schemas.html</em>,
extract
<ul>
    <li>NAMESPACE: open</li>
    <li>DOCTYPE: doc</li>
</ul>
Example script:
<pre>
#!/bin/bash

set -x

ENDPOINT="https://vespacloud-docsearch.vespa-team.aws-us-east-1c.public.vespa.oath.cloud"
NAMESPACE=open
DOCTYPE=doc
CLUSTER=documentation

continuation=""
idx=0

while [ "$continuation" != "continuation=" ]
do
  ((idx+=1))
  echo "$continuation"
  printf -v out "%05g" $idx
  filename=${NAMESPACE}-${DOCTYPE}-${out}.data.gz
  echo "Fetching data..."
  curl -s --cert data-plane-public-cert.pem --key data-plane-private-key.pem \
    "${ENDPOINT}/document/v1/${NAMESPACE}/${DOCTYPE}/docid?wantedDocumentCount=1000&amp;concurrency=4&amp;cluster=${CLUSTER}&amp;${continuation}" | gzip > ${filename}
  continuation="continuation=`gunzip -c ${filename} | head -c 300 | grep '"continuation":"' | cut -d'"' -f4`"
done
</pre>
On <em>concurrency</em>: higher concurrency increases temporal memory use while dumping data, returning more documents per request.
<em>wantedDocumentCount</em> is max 1000.
</p>



<h2 id="feed">Feed</h2>
<p>
Use the <a href="https://docs.vespa.ai/documentation/vespa-http-client.html">vespa-http-client</a>
to feed documents in batches to endpoints - example:
<pre>
$ gunzip -c open-doc-00001.data.gz | <a href="https://stedolan.github.io/jq/">jq</a> '.documents[]' | \
  java -jar $HOME/github/vespa-engine/vespa/vespa-http-client/target/vespa-http-client-jar-with-dependencies.jar \
  --endpoint $ENDPOINT --disable-hostname-verification \
  --useTls --certificate data-plane-public-cert.pem --privateKey data-plane-private-key.pem
</pre>
Note that the data dump cannot be directly fed, as extra fields like continuation token are added -
hence the <a href="https://stedolan.github.io/jq/">jq</a> command to extract <em>document</em> objects only.
</p><p>

</p>



<h2 id="delete">Delete</h2>
<p>
To purge all documents, generate a feed with remove-entries for all document IDs, like:
<pre>
$ gunzip -c open-doc-00001.data.gz | jq '[ .documents[] | {remove: .id} ]' | head

[
  {
    "remove": "id:open:doc::open/documentation/schemas.html"
  },
  {
    "remove": "id:open:doc::open/documentation/securing-your-vespa-installation.html"
  },
</pre>
Hence, extracts all IDs and feed to the endpoint to remove:
<pre>
$ gunzip -c open-doc-00001.data.gz | jq '[ .documents[] | {remove: .id} ]' | \
  java -jar $HOME/github/vespa-engine/vespa/vespa-http-client/target/vespa-http-client-jar-with-dependencies.jar \
  --endpoint $ENDPOINT --disable-hostname-verification \
  --useTls --certificate data-plane-public-cert.pem --privateKey data-plane-private-key.pem
</pre>
Pro Tip: Reduce file size by only dumping IDs using <code>&fieldSet=%5Bid%5D</code> (above).
</p>
